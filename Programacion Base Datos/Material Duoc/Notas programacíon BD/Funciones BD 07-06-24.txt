/*

CREE UNA FUNCION QUE, INGRESANDO EL ID DE UN DEPARTAMEMTO, ME RETORNE LA CANTIDAD DE
EMPLEADOS QUE TRABAJAN EN EL DEPARMTAMENTO INGRESADO

*/

CREATE OR REPLACE FUNCTION CANT_EMPLEADOS(V_ID_DEPA NUMBER)
RETURN NUMBER
IS
    V_CANT_EMPLEADOS NUMBER;

BEGIN 
    SELECT COUNT(EMPLOYEE_ID)
    INTO V_CANT_EMPLEADOS
    FROM EMPLOYEES
    WHERE DEPARTMENT_ID = V_ID_DEPA;
    
    RETURN V_CANT_EMPLEADOS;

EXCEPTION
    WHEN NO_DATA_FOUND THEN
        INSERT INTO ERROR_PROCESO VALUES(SYSDATE, 'CANT_EMPLEADOS', 'NO SE ENCONTRARON EMPLEADOS EN EL DEPARTAMENTO');
    WHEN OTHERS THEN
        INSERT INTO ERROR_PROCESO VALUES(SYSDATE, 'CANT_EMPLEADOS', 'OTRO ERROR');
END;


/*
CREE UNA FUNCION QUE INGRESANDO EL DATO EMPLOYEE_ID,RETORNE EL PAIS EN EL QUE VIVE
EL EMPLEADO


*/

CREATE OR REPLACE FUNCTION VER_PAIS(V_EMPLOYEE_ID NUMBER)
RETURN VARCHAR
IS
    V_NOMBRE_PAIS VARCHAR(50);
BEGIN
    SELECT C.COUNTRY_NAME
    INTO V_NOMBRE_PAIS
    FROM COUNTRIES C
    RIGHT JOIN LOCATIONS L ON C.COUNTRY_ID = L.COUNTRY_ID
    RIGHT JOIN DEPARTMENTS D ON D.LOCATION_ID = L.LOCATION_ID
    RIGHT JOIN EMPLOYEES E ON E.DEPARTMENT_ID = D.DEPARTMENT_ID
    WHERE E.EMPLOYEE_ID = V_EMPLOYEE_ID;
    
    RETURN V_NOMBRE_PAIS;
END;

/*
CREE UNA FUNCION QUE PERMITA INGRESAR EL ID DE UN EMPLEADO, QUE RETORNE EL NOMBRE DEL JEFE

*/

CREATE OR REPLACE FUNCTION MANAGER_NAME(v_EMPLOYEE_ID NUMBER)
RETURN VARCHAR

IS 
    V_NOMBRE_JEFE VARCHAR(100);
BEGIN
    select JEFES.FIRST_NAME
    INTO V_NOMBRE
    FROM EMPLOYEES JEFES ON EMP.MANAGER_ID = JEFES.EMPLOYEE_ID
    WHERE EMP.EMPLOYEE_ID = V_EMPLOYEE_ID;
    
    RETURN V_NOMBRE_JEFE;

END;
    

    
/*
CREATE TABLE ERROR_PROCESO (
    FECHA_PREOCESO DATE,
    PROCESO VARCHAR(250),
    MSG_ERROR VARCHAR(250)
)
*/


-----------------------Primer Ejercicio-------------------------------------------
SELECT DEPARTMENT_ID, DEPARTMENT_NAME, CANT_EMPLEADOS(DEPARTMENT_ID)

FROM DEPARTMENTS;

--------------------------Segundo Ejercicio-----------------------------------}

SELECT EMPLOYEE_ID,FIRST_NAME||' '||LAST_NAME,VER_PAIS(EMPLOYEE_ID)
FROM EMPLOYEES;

------------------------------Tercer ejercicio------------------------------------------------------
SELECT FIRST_NAME,SALARY,MANAGER_NAME(EMPLOYEE_ID) JEFE
FROM EMPLOYEES
WHERE EMPLOYEE_ID = 145